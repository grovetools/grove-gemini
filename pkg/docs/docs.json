{
  "sections": {
    "cli-reference": {
      "title": "CLI Reference",
      "content": "Complete command reference for `grove-gemini`.",
      "subsections": [
        {
          "title": "grove-gemini",
          "content": "\u003cdiv class=\"terminal\"\u003e\nTools for Google's Gemini API\n\nUsage:\n  grove-gemini [command]\n\nAvailable Commands:\n  cache        Manage the local cache of Gemini contexts\n  completion   Generate the autocompletion script for the specified shell\n  config       Manage grove-gemini configuration\n  count-tokens Count tokens for a given text using Gemini API\n  help         Help about any command\n  query        Query Gemini API usage, metrics, and billing data from Google Cloud\n  request      Make a request to Gemini API with grove-context support\n  version      Print the version information for this binary\n\nFlags:\n  -c, --config string   Path to grove.yml config file\n  -h, --help            help for grove-gemini\n      --json            Output in JSON format\n  -v, --verbose         Enable verbose logging\n\nUse \"grove-gemini [command] --help\" for more information about a command.\n\u003c/div\u003e\n\n### grove-gemini request\n\n\u003cdiv class=\"terminal\"\u003e\nMake a request to the Gemini API using grove-context for automatic hot/cold context management.\n\nThis command works similarly to grove-flow's oneshot executor:\n- Uses .grove/rules to generate context if available\n- Manages cold context caching automatically\n- Includes hot context as dynamic files\n- Supports custom cache TTL and directives from rules file\n\nExamples:\n  # Simple prompt\n  grove-gemini request -p \"Explain the main function\"\n\n  # From file\n  grove-gemini request -f prompt.md\n\n  # With specific model and output file\n  grove-gemini request -m gemini-2.0-flash -f prompt.md -o response.md\n\n  # Regenerate context before request\n  grove-gemini request --regenerate -p \"Review the codebase architecture\"\n\n  # Force recreation of cache\n  grove-gemini request --recache -p \"Review the codebase architecture\"\n\n  # Use a specific cache\n  grove-gemini request --use-cache 53f364cda78e82a8 -p \"Review using old context\"\n\n  # With custom working directory\n  grove-gemini request -w /path/to/project -p \"Analyze this project\"\n\nUsage:\n  grove-gemini request [flags]\n\nFlags:\n      --cache-ttl string          Cache TTL (e.g., 1h, 30m, 24h) (default \"5m\")\n      --context strings           Additional context files to include\n  -f, --file string               Read prompt from file\n  -h, --help                      help for request\n      --max-output-tokens int32   Maximum tokens in response (-1 to use default) (default -1)\n  -m, --model string              Gemini model to use (default \"gemini-2.0-flash\")\n      --no-cache                  Disable context caching\n  -o, --output string             Write response to file instead of stdout\n  -p, --prompt string             Prompt text\n      --recache                   Force recreation of the Gemini cache\n      --regenerate                Regenerate context before request\n      --temperature float32       Temperature for randomness (0.0-2.0, -1 to use default) (default -1)\n      --top-k int32               Top-k sampling (-1 to use default) (default -1)\n      --top-p float32             Top-p nucleus sampling (0.0-1.0, -1 to use default) (default -1)\n      --use-cache string          Specify a cache name (short hash) to use for this request, bypassing automatic selection\n  -w, --workdir string            Working directory (defaults to current)\n  -y, --yes                       Skip cache creation confirmation prompt\n\nGlobal Flags:\n  -c, --config string   Path to grove.yml config file\n      --json            Output in JSON format\n  -v, --verbose         Enable verbose logging\n\u003c/div\u003e\n\n### grove-gemini cache\n\n\u003cdiv class=\"terminal\"\u003e\nProvides commands to manage the local cache of Gemini API context data. You can list, inspect, clear, and prune cached items. Use 'grove-gemini cache tui' to launch the interactive interface.\n\nUsage:\n  grove-gemini cache [command]\n\nAvailable Commands:\n  clear       Clear caches from Google's servers (default: remote-only)\n  inspect     Show detailed information about a specific cache\n  list        List all caches with both local and API status\n  prune       Mark expired caches as cleared and optionally clean up\n  tui         Launch the interactive cache management TUI\n\nFlags:\n  -h, --help   help for cache\n\nGlobal Flags:\n  -c, --config string   Path to grove.yml config file\n      --json            Output in JSON format\n  -v, --verbose         Enable verbose logging\n\nUse \"grove-gemini cache [command] --help\" for more information about a command.\n\u003c/div\u003e\n\n#### grove-gemini cache clear\n\n\u003cdiv class=\"terminal\"\u003e\nClears caches from Google's servers and updates local tracking.\nBy default, only clears the remote cache and marks the local file as cleared.\nUse --with-local to also remove the local cache file.\nUse --preserve-local to skip updating the local cache file.\n\nUsage:\n  grove-gemini cache clear [cache-name...] | --all [flags]\n\nFlags:\n      --all              Clear all caches in the current project\n  -h, --help             help for clear\n      --preserve-local   Don't update local cache files at all\n      --with-local       Also remove local cache files (default: mark as cleared)\n\nGlobal Flags:\n  -c, --config string   Path to grove.yml config file\n      --json            Output in JSON format\n  -v, --verbose         Enable verbose logging\n\u003c/div\u003e\n\n#### grove-gemini cache inspect\n\n\u003cdiv class=\"terminal\"\u003e\nShow detailed information about a specific cache\n\nUsage:\n  grove-gemini cache inspect [cache-name] [flags]\n\nFlags:\n  -h, --help   help for inspect\n\nGlobal Flags:\n  -c, --config string   Path to grove.yml config file\n      --json            Output in JSON format\n  -v, --verbose         Enable verbose logging\n\u003c/div\u003e\n\n#### grove-gemini cache list\n\n\u003cdiv class=\"terminal\"\u003e\nList cached contents showing both local storage and Google API status.\nBy default, shows a combined view of local cache files and their status on Google's servers.\nUse --local-only or --api-only to filter the view.\n\nUsage:\n  grove-gemini cache list [flags]\n\nFlags:\n      --api-only     Show only caches from Google's API servers\n  -h, --help         help for list\n      --local-only   Show only local cache information\n\nGlobal Flags:\n  -c, --config string   Path to grove.yml config file\n      --json            Output in JSON format\n  -v, --verbose         Enable verbose logging\n\u003c/div\u003e\n\n#### grove-gemini cache prune\n\n\u003cdiv class=\"terminal\"\u003e\nMarks expired cache records as cleared and removes them from Google's API.\nBy default, updates local files to mark them as expired.\nUse --remove-local to also remove the local cache files.\n\nUsage:\n  grove-gemini cache prune [flags]\n\nFlags:\n  -h, --help           help for prune\n      --remove-local   Remove local cache files instead of marking them\n\nGlobal Flags:\n  -c, --config string   Path to grove.yml config file\n      --json            Output in JSON format\n  -v, --verbose         Enable verbose logging\n\u003c/div\u003e\n\n#### grove-gemini cache tui\n\n\u003cdiv class=\"terminal\"\u003e\nLaunch the interactive cache management TUI\n\nUsage:\n  grove-gemini cache tui [flags]\n\nFlags:\n  -h, --help   help for tui\n\nGlobal Flags:\n  -c, --config string   Path to grove.yml config file\n      --json            Output in JSON format\n  -v, --verbose         Enable verbose logging\n\u003c/div\u003e\n\n### grove-gemini query\n\n\u003cdiv class=\"terminal\"\u003e\nProvides commands to query various Google Cloud services for Gemini API metrics, token usage logs, and billing information.\n\nUsage:\n  grove-gemini query [command]\n\nAvailable Commands:\n  billing     Query Gemini API billing data from BigQuery\n  dashboard   Interactive dashboard for GCP billing data visualization\n  explore     Explore available logs for Gemini API\n  local       Query local Gemini API logs\n  metrics     Query Gemini API metrics from Cloud Monitoring\n  requests    Query individual Gemini API requests from local logs\n  tokens      Query detailed token usage from Cloud Logging\n  tui         Launch an interactive TUI to visualize local query logs\n\nFlags:\n  -h, --help   help for query\n\nGlobal Flags:\n  -c, --config string   Path to grove.yml config file\n      --json            Output in JSON format\n  -v, --verbose         Enable verbose logging\n\nUse \"grove-gemini query [command] --help\" for more information about a command.\n\u003c/div\u003e\n\n#### grove-gemini query billing\n\n\u003cdiv class=\"terminal\"\u003e\nFetches and displays Gemini API billing information from a BigQuery billing export table.\n\nThis command requires a BigQuery billing export table containing detailed usage cost data to be enabled for your billing account. \n\nTo set up billing export:\n1. Go to the Google Cloud Console Billing section\n2. Select your billing account\n3. Click \"Billing export\"\n4. Enable \"Detailed usage cost\" export to BigQuery\n5. Note the dataset and table IDs created\n\nUsage:\n  grove-gemini query billing [flags]\n\nFlags:\n  -d, --dataset-id string   BigQuery dataset ID containing billing export\n      --days int            Number of days to look back (default 7)\n  -h, --help                help for billing\n  -p, --project-id string   GCP project ID\n  -t, --table-id string     BigQuery table ID for billing export\n\nGlobal Flags:\n  -c, --config string   Path to grove.yml config file\n      --json            Output in JSON format\n  -v, --verbose         Enable verbose logging\n\u003c/div\u003e\n\n#### grove-gemini query dashboard\n\n\u003cdiv class=\"terminal\"\u003e\nLaunches an interactive TUI dashboard that visualizes Gemini API billing data from BigQuery.\n\nFeatures:\n- Real-time cost visualization\n- Daily/weekly/monthly views\n- SKU breakdown table\n- Interactive navigation\n\nUsage:\n  grove-gemini query dashboard [flags]\n\nFlags:\n  -d, --dataset-id string   BigQuery dataset ID containing billing export\n      --days int            Number of days to display (default 30)\n  -h, --help                help for dashboard\n  -p, --project-id string   GCP project ID\n  -t, --table-id string     BigQuery table ID for billing export\n\nGlobal Flags:\n  -c, --config string   Path to grove.yml config file\n      --json            Output in JSON format\n  -v, --verbose         Enable verbose logging\n\u003c/div\u003e\n\n#### grove-gemini query explore\n\n\u003cdiv class=\"terminal\"\u003e\nExplores Cloud Logging to find what logs are available for the Gemini API service.\nThis command helps discover the correct resource types, log names, and payload structures.\n\nUsage:\n  grove-gemini query explore [flags]\n\nFlags:\n  -h, --help                help for explore\n  -H, --hours int           Number of hours to look back (default 1)\n  -l, --limit int           Maximum number of entries to examine (default 10)\n  -p, --project-id string   GCP project ID\n\nGlobal Flags:\n  -c, --config string   Path to grove.yml config file\n      --json            Output in JSON format\n  -v, --verbose         Enable verbose logging\n\u003c/div\u003e\n\n#### grove-gemini query local\n\n\u003cdiv class=\"terminal\"\u003e\nDisplays locally logged Gemini API requests with token usage, costs, and performance metrics.\n\nUsage:\n  grove-gemini query local [flags]\n\nFlags:\n      --errors         Show only failed requests\n  -h, --help           help for local\n  -H, --hours int      Number of hours to look back (default 24)\n  -l, --limit int      Maximum number of requests to display (default 100)\n  -m, --model string   Filter by model name\n\nGlobal Flags:\n  -c, --config string   Path to grove.yml config file\n      --json            Output in JSON format\n  -v, --verbose         Enable verbose logging\n\u003c/div\u003e\n\n#### grove-gemini query metrics\n\n\u003cdiv class=\"terminal\"\u003e\nFetches and displays Gemini API request counts, error rates, and latency metrics from Google Cloud Monitoring.\n\nUsage:\n  grove-gemini query metrics [flags]\n\nFlags:\n      --debug               Enable debug output\n  -h, --help                help for metrics\n  -H, --hours int           Number of hours to look back (default 24)\n  -p, --project-id string   GCP project ID\n\nGlobal Flags:\n  -c, --config string   Path to grove.yml config file\n      --json            Output in JSON format\n  -v, --verbose         Enable verbose logging\n\u003c/div\u003e\n\n#### grove-gemini query requests\n\n\u003cdiv class=\"terminal\"\u003e\nDisplays a table of individual Gemini API requests with details like timestamp, method, tokens, latency, and status.\n\nThis command reads from local logs since Google doesn't publish individual Gemini API requests to Cloud Logging.\n\nUsage:\n  grove-gemini query requests [flags]\n\nFlags:\n      --errors         Show only failed requests\n  -h, --help           help for requests\n  -H, --hours int      Number of hours to look back (default 1)\n  -l, --limit int      Maximum number of requests to display (default 100)\n  -m, --model string   Filter by model name\n\nGlobal Flags:\n  -c, --config string   Path to grove.yml config file\n      --json            Output in JSON format\n  -v, --verbose         Enable verbose logging\n\u003c/div\u003e\n\n#### grove-gemini query tokens\n\n\u003cdiv class=\"terminal\"\u003e\nFetches and displays detailed Gemini API token usage information including prompt tokens, completion tokens, cache hits, and estimated costs from Google Cloud Logging.\n\nUsage:\n  grove-gemini query tokens [flags]\n\nFlags:\n      --debug               Enable debug output\n  -h, --help                help for tokens\n  -H, --hours int           Number of hours to look back (default 24)\n  -p, --project-id string   GCP project ID\n\nGlobal Flags:\n  -c, --config string   Path to grove.yml config file\n      --json            Output in JSON format\n  -v, --verbose         Enable verbose logging\n\u003c/div\u003e\n\n#### grove-gemini query tui\n\n\u003cdiv class=\"terminal\"\u003e\nLaunch an interactive TUI to visualize local query logs\n\nUsage:\n  grove-gemini query tui [flags]\n\nFlags:\n  -h, --help   help for tui\n\nGlobal Flags:\n  -c, --config string   Path to grove.yml config file\n      --json            Output in JSON format\n  -v, --verbose         Enable verbose logging\n\u003c/div\u003e\n\n### grove-gemini config\n\n\u003cdiv class=\"terminal\"\u003e\nConfigure default settings for grove-gemini, such as the default GCP project.\n\nUsage:\n  grove-gemini config [command]\n\nAvailable Commands:\n  get         Get configuration values\n  set         Set configuration values\n\nFlags:\n  -h, --help   help for config\n\nGlobal Flags:\n  -c, --config string   Path to grove.yml config file\n      --json            Output in JSON format\n  -v, --verbose         Enable verbose logging\n\nUse \"grove-gemini config [command] --help\" for more information about a command.\n\u003c/div\u003e\n\n#### grove-gemini config get\n\n\u003cdiv class=\"terminal\"\u003e\nGet configuration values\n\nUsage:\n  grove-gemini config get [command]\n\nAvailable Commands:\n  billing     Get the default BigQuery billing configuration\n  project     Get the default GCP project\n\nFlags:\n  -h, --help   help for get\n\nGlobal Flags:\n  -c, --config string   Path to grove.yml config file\n      --json            Output in JSON format\n  -v, --verbose         Enable verbose logging\n\nUse \"grove-gemini config get [command] --help\" for more information about a command.\n\u003c/div\u003e\n\n#### grove-gemini config get billing\n\n\u003cdiv class=\"terminal\"\u003e\n\n\u003c/div\u003e\n\n#### grove-gemini config get project\n\n\u003cdiv class=\"terminal\"\u003e\n\n\u003c/div\u003e\n\n#### grove-gemini config set\n\n\u003cdiv class=\"terminal\"\u003e\nSet configuration values\n\nUsage:\n  grove-gemini config set [command]\n\nAvailable Commands:\n  billing     Set the default BigQuery billing dataset and table\n  project     Set the default GCP project\n\nFlags:\n  -h, --help   help for set\n\nGlobal Flags:\n  -c, --config string   Path to grove.yml config file\n      --json            Output in JSON format\n  -v, --verbose         Enable verbose logging\n\nUse \"grove-gemini config set [command] --help\" for more information about a command.\n\u003c/div\u003e\n\n#### grove-gemini config set billing\n\n\u003cdiv class=\"terminal\"\u003e\n\n\u003c/div\u003e\n\n#### grove-gemini config set project\n\n\u003cdiv class=\"terminal\"\u003e\n\n\u003c/div\u003e\n\n### grove-gemini version\n\n\u003cdiv class=\"terminal\"\u003e\nPrint the version information for this binary\n\nUsage:\n  grove-gemini version [flags]\n\nFlags:\n  -h, --help   help for version\n      --json   Output version information in JSON format\n\nGlobal Flags:\n  -c, --config string   Path to grove.yml config file\n  -v, --verbose         Enable verbose logging\n\u003c/div\u003e"
        }
      ]
    },
    "config-descriptions": {
      "title": "Configuration Descriptions",
      "content": "{\n  \"api_key\": \"Specifies the Google Gemini API authentication key directly as a string. Use this for local, private configuration files (`grove.override.yml`) where convenience is prioritized over strict secret management, ensuring you do not commit actual credentials to version control.\",\n  \"api_key_command\": \"Defines a shell command that outputs the Gemini API key to standard output (e.g., `gcloud secrets versions access latest ...` or `op read ...`). This is the recommended method for shared configuration files, as it retrieves credentials dynamically from a secure store like Google Secret Manager or 1Password without hardcoding secrets.\"\n}"
    },
    "config-examples": {
      "title": "Configuration Examples",
      "content": "{\n  \"api_key\": {\n    \"example\": \"[gemini]\\napi_key = \\\"AIzaSyD-ExampleKey123456789\\\"\",\n    \"description\": \"Sets the Google Gemini API key directly in the configuration file. Note: Using `api_key_command` or environment variables is recommended for security.\"\n  },\n  \"api_key_command\": {\n    \"example\": \"[gemini]\\n# Retrieve key from 1Password\\napi_key_command = \\\"op read 'op://Private/Gemini API Key/credential'\\\"\",\n    \"description\": \"Specifies a shell command to retrieve the API key at runtime, allowing integration with secret managers like 1Password or Google Secret Manager.\"\n  }\n}"
    },
    "configuration": {
      "title": "Configuration",
      "content": "",
      "code_blocks": [
        "{\"src\": \"/data/grove-gemini/03-configuration.json\", \"examplesSrc\": \"/data/grove-gemini/gemini.examples.json\", \"examplesFormat\": \"toml\"}"
      ]
    },
    "overview": {
      "title": "Overview",
      "content": "`grove-gemini` is a command-line tool for interacting with Google's Gemini models. It provides infrastructure for managing context caching, executing prompts, and monitoring API usage through local logs and remote GCP metrics.",
      "subsections": [
        {
          "title": "Core Mechanisms",
          "content": "**Context Caching Lifecycle**: The tool automates the management of Gemini's context caching feature. It distinguishes between:\n*   **Cold Context**: Static files defined in `.grove/cached-context` or via `.grove/rules`. The tool hashes these files; if the content changes, a new cache is created. If the hash matches an existing active cache on Google's servers, that cache is reused.\n*   **Hot Context**: Dynamic files passed at runtime which are sent with every request.\n\n**Dual-Layer Observability**:\n*   **Local Logging**: Every request made through the CLI is logged to JSONL files in `~/.local/state/grove/logs/gemini/`. This provides immediate access to request parameters, token usage, and response latency.\n*   **Remote Analytics**: The `query` command suite interfaces with Google Cloud Monitoring and BigQuery. It aggregates billing data and service-level metrics to provide cost analysis and usage trends across the organization.\n\n**Configuration Resolution**: Project settings (GCP Project ID, Billing datasets) are resolved hierarchically from command-line flags, environment variables, and the `grove.yml` configuration file."
        },
        {
          "title": "Features",
          "content": "### Request Execution\n*   **`gemini request`**: Sends prompts to Gemini models. It parses `.grove/rules` to automatically assemble context, handles cache creation/lookup transparently, and supports output redirection.\n*   **`gemini count-tokens`**: Calculates token counts for input text using the model's tokenizer to estimate usage against context window limits.\n\n### Cache Management\n*   **`gemini cache list`**: Displays local and remote status of context caches, including expiration times and token counts.\n*   **`gemini cache prune`**: Identifies and removes expired caches from the local state tracking.\n*   **`gemini cache tui`**: An interactive terminal interface for managing caches. It provides views for inspecting cache metadata, viewing usage efficiency scores, and manually deleting entries.\n\n### Analytics \u0026 Monitoring\n*   **`gemini query local`**: Displays a tabular view of recent requests initiated from the local machine, including estimated costs and response times.\n*   **`gemini query billing`**: Queries BigQuery exports to show actual accrued costs by SKU (e.g., Input Tokens, Output Tokens).\n*   **`gemini query dashboard`**: Launches a terminal dashboard visualizing cost trends, request volume, and SKU breakdowns over time."
        },
        {
          "title": "Integrations",
          "content": "*   **`grove-flow`**: Acts as the execution engine for Gemini-based jobs within Flow plans.\n*   **`grove cx`**: Uses context rules defined by `cx` to determine which files should be included in the cached context."
        }
      ]
    }
  }
}