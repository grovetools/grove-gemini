{
  "sections": {
    "configuration": {
      "title": "Configuration",
      "content": "",
      "subsections": [
        {
          "title": "Gemini Settings",
          "content": "| Property | Description |\n| :--- | :--- |\n| `api_key` | (string, optional) The raw API key string used to authenticate with Google's Gemini API. While supported, storing API keys in plain text configuration files is discouraged. This value is used only if the `GEMINI_API_KEY` environment variable is not set and `api_key_command` is not configured. |\n| `api_key_command` | (string, optional) A shell command to execute to retrieve the API key. This property allows for secure integration with password managers (e.g., `1op`, `pass`, `lpass`) or other secret stores. The command should output the key to stdout. This takes precedence over the static `api_key` field. |",
          "code_blocks": [
            "gemini:\n  # Securely fetch the API key using a password manager CLI\n  api_key_command: \"op read op://Private/Gemini/credential\"\n  \n  # Or set directly (not recommended for version-controlled files)\n  # api_key: \"AIzaSy...\""
          ]
        }
      ]
    },
    "overview": {
      "title": "Overview",
      "content": "`grove-gemini` is a command-line tool for interacting with Google's Gemini models. It provides infrastructure for managing context caching, executing prompts, and monitoring API usage through local logs and remote GCP metrics.",
      "subsections": [
        {
          "title": "Core Mechanisms",
          "content": "**Context Caching Lifecycle**: The tool automates the management of Gemini's context caching feature. It distinguishes between:\n*   **Cold Context**: Static files defined in `.grove/cached-context` or via `.grove/rules`. The tool hashes these files; if the content changes, a new cache is created. If the hash matches an existing active cache on Google's servers, that cache is reused.\n*   **Hot Context**: Dynamic files passed at runtime which are sent with every request.\n\n**Dual-Layer Observability**:\n*   **Local Logging**: Every request made through the CLI is logged to JSONL files in `~/.local/state/grove/logs/gemini/`. This provides immediate access to request parameters, token usage, and response latency.\n*   **Remote Analytics**: The `query` command suite interfaces with Google Cloud Monitoring and BigQuery. It aggregates billing data and service-level metrics to provide cost analysis and usage trends across the organization.\n\n**Configuration Resolution**: Project settings (GCP Project ID, Billing datasets) are resolved hierarchically from command-line flags, environment variables, and the `grove.yml` configuration file."
        },
        {
          "title": "Features",
          "content": "### Request Execution\n*   **`gemini request`**: Sends prompts to Gemini models. It parses `.grove/rules` to automatically assemble context, handles cache creation/lookup transparently, and supports output redirection.\n*   **`gemini count-tokens`**: Calculates token counts for input text using the model's tokenizer to estimate usage against context window limits.\n\n### Cache Management\n*   **`gemini cache list`**: Displays local and remote status of context caches, including expiration times and token counts.\n*   **`gemini cache prune`**: Identifies and removes expired caches from the local state tracking.\n*   **`gemini cache tui`**: An interactive terminal interface for managing caches. It provides views for inspecting cache metadata, viewing usage efficiency scores, and manually deleting entries.\n\n### Analytics \u0026 Monitoring\n*   **`gemini query local`**: Displays a tabular view of recent requests initiated from the local machine, including estimated costs and response times.\n*   **`gemini query billing`**: Queries BigQuery exports to show actual accrued costs by SKU (e.g., Input Tokens, Output Tokens).\n*   **`gemini query dashboard`**: Launches a terminal dashboard visualizing cost trends, request volume, and SKU breakdowns over time."
        },
        {
          "title": "Integrations",
          "content": "*   **`grove-flow`**: Acts as the execution engine for Gemini-based jobs within Flow plans.\n*   **`grove cx`**: Uses context rules defined by `cx` to determine which files should be included in the cached context."
        }
      ]
    }
  }
}